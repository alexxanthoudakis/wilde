<?xml version="1.0" encoding="UTF-8"?>
<div data-template="templates:surround" data-template-at="content"
  data-template-with="templates/page.html" xmlns="http://www.w3.org/1999/xhtml">
  <div class="row">
    <div class="page-header">
      <h1>News reports</h1>
      <p>Introductory text goes here.</p>

      <ul id="report-tabs" class="nav nav-tabs" role="tablist">
        <li role="presentation" class="active"><a href="#all" id="all-tab" role="tab" data-toggle="tab" aria-controls="all" aria-expanded="true">View all</a></li>
        <li role="presentation"><a href="#date" role="tab" id="date-tab" data-toggle="tab" aria-controls="date">View by date</a></li>
        <li role="presentation"><a href="#newspaper" role="tab" id="newspaper-tab" data-toggle="tab" aria-controls="newspaper">View by newspaper</a></li>
        <li role="presentation"><a href="#region" role="tab" id="region-tab" data-toggle="tab" aria-controls="region">View by region</a></li>
        <li role="presentation"><a href="#language" role="tab" id="language-tab" data-toggle="tab" aria-controls="language">View by language</a></li>
      </ul>
    </div>
  </div>
  <div class="row">
    <div class="tab-content">
      <div role="tabpanel" class="tab-pane fade active in" id="all" aria-labelledby="all-tab">
        <p>The complete list of news reports on Wildeâ€™s trials is below. Each
          column provides basic metadata about an individual report. To
          open any report, click on its date.</p>
        <div id="chart"></div>
        <div data-template="app:browse" />
      </div>
      <div role="tabpanel" class="tab-pane fade" id="date" aria-labelledby="date-tab">
        <div data-template="app:browse-date"/>
      </div>
      <div role="tabpanel" class="tab-pane fade" id="newspaper" aria-labelledby="newspaper-tab">
        <div data-template="app:browse-newspaper"/>
      </div>
      <div role="tabpanel" class="tab-pane fade" id="region" aria-labelledby="region-tab"></div>
      <div role="tabpanel" class="tab-pane fade" id="language" aria-labelledby="language-tab"></div>
    </div>
  </div>
  <link rel="stylesheet" type="text/css" href="resources/lib/bootstrap-table/bootstrap-table.min.css" />
  <script type="text/javascript" src="resources/lib/bootstrap-table/bootstrap-table.min.js"></script>
  <!-- <script type="text/javascript" src="resources/lib/tablesorter/jquery.tablesorter.min.js"></script>
  <script type="text/javascript"> $(document).ready(function(){ $("#tbl-browser").tablesorter(); }); </script> -->
  <script type="text/javascript" src="resources/js/list.js"></script>
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
  <script type="text/javascript">
    google.charts.load('current', {'packages':['corechart']});
    google.charts.setOnLoadCallback(drawChart);

    var annotations = {
      '1895-04-03': ['Libel trial', 'The beginning of the criminal libel trial, initiated by Oscar Wilde against the Marquis of Queensbury.'],
      '1895-04-26': ['First criminal trial', 'The beginning of the first criminal trial against Oscar Wilde and Alfred Taylor for "gross indecency."'],
      '1895-05-23': ['Second criminal trial', 'The beginning of the second criminal trial against Oscar Wilde for "gross indecency."'],
      '1895-05-25': ['Oscar Wilde Convicted', 'Oscar Wilde convicted of "gross indecency" and given a two-year prison sentence with hard labour.'],
    };

    function drawChart() {
      var $dateItems = $("li[data-date]");
      if($dateItems.length === 0) {
        return;
      }
      var languages = $("#languages").data('languages').toLowerCase().split(',');

      var data = new google.visualization.DataTable();
      data.addColumn('string', 'Date');
      //data.addColumn('number', 'Article Count');
      languages.forEach(function(language) {
        data.addColumn('number', language);
      });

      data.addColumn({type: 'string', role: 'annotation'});
      data.addColumn({type: 'string', role: 'annotationText'});

      $dateItems.each(function(index,$item) {
        var $this = $(this);
        var date = $(this).data('date');
        var item = [];
        item.push(date);
        // item.push($this.data('count'));
        languages.forEach(function(language){
          item.push($this.data(language));
        });

        if(date in annotations) {
          item.push(annotations[date][0])
          item.push(annotations[date][1]);
        } else {
          item.push(null);
          item.push(null);
        }
        data.addRow(item);
      });

      var options = {
        title: 'Articles by Day',
        curveType: 'function',
        legend: { position: 'bottom' }
      };

      var chart = new google.visualization.LineChart(document.getElementById('chart'));
      chart.draw(data, options);
    }
  </script>
</div>
